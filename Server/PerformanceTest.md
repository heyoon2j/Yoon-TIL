# Performance Test
* 구축 및 확장, 서비스 배포 등 후에 성능을 테스트해야 한다.
* 응답시간, 처리량, 병목 현상, 예외 상황 등을 확인할 수 있고, 성능 테스트를 통해 얻은 정보들을 통해서 문제점을 개선할 수 있기 대문이다.


## 성능 테스트 쓰임 종류
| Test                       | Description                                                                                                                                                                                                                                  |
| -------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Load Test                  | 부하(Load)를 순차적으로 증가시키면서, 응답시간이 급격히 증가하거나 더는 처리량이 증가하지 않거나, CPU와 Memory 등이 기준값 이상으로 증가하는 등 비정상 상태가 발생하는 임계점을 찾아내고 이를 바탕으로 성능 이슈에 대한 튜닝과 테스트를 반복 |
| Stress Test                | 임계값 이상의 요청이나 비정상적인 요청을 보내 비정상적인 상황의 처리 상태를 확인하고 시스템의 최고 성능 한계를 측정하기 위한 테스트                                                                                                          |
| Spike Test                 | 갑자기 사용자가 몰렸을 때 요청이 정상적으로 처리되는지 그리고 그 업무 부하가 줄어들 때 정상적으로 반응하는지를 확인하기 위한 테스트                                                                                                          |
| Stability Test / Soak Test | 긴 시간 동안 테스트를 진행하여 테스트 시간에 따른 시스템의 메모리 증가, 성능 정보의 변화 등을 확인하여 안정성을 확인하는 테스트                                                                                                              |


## 성능 테스트
* 성능 측정을 위해서는 아래와 같이 준비해야 한다.
1. 요구사항 분석 및 테스트 계획 (테스트 개요, 테스트 범위, 목표성능 지표)
2. 테스트 환경 구축
3. 테스트 설계 (테스트 수행절차, 수행일정, 테스트 시나리오, 지원 요청사항)
4. 테스트 수행 및 결과 수집
5. 테스트 분석
6. 문제점 수정 및 재테스트
7. 결과 리포트 작성


## 테스트 개요
* 여기서는 정확한 요구사항 분석을 통해 전반적인 내용을 결정한다.
* 성능 테스트 일정 및 장소 : 언제, 어디서할 지 결정
    * ex> 일시: 2021년 8월 4일 ~ 2021년 11월 30일 / 장소: 상암 월드컵경기장
* 성능 테스트의 목적 : 어떤 시스템의 어떤 성능을 테스트하는지 정확한 목적 결정. 정확한 목적 결정을 통해 중요도와 목적에 맞는 우선순위 등을 결정할 수 있다.
    * ex> 클라우드 확장 이후 부하 성능 테스트
* 성능 테스트 수행방안 : 어떤 식으로 테스트 하는지 결정
    * 단위 성능 < 통합 성능 테스트 < 안정성 테스트
    * ex> 통합 성능 테스트 = 채널 통합 성능 + 시스템 통합 성능
    * ex> 안정성 테스트 = 임계 테스트 + 안정성 테스트
* 성능 테스트 환경 : 성능을 테스트하기 위한 환경을 결정
    * 일반적인 성능 테스트 환경에 사용되는 Module은 다음 표와 같다. ex> (컨트롤러 / LoadRunner), (대상서버 / VM) 등

    | Module     | Description                                               |
    | ---------- | --------------------------------------------------------- |
    | 컨트롤러   | 부하발생기에 신호를 쏴주는 역할                           |
    | 부하발생기 | 부하를 발생시키는 역할                                    |
    | 모니터링   | 성능을 모니터하는 역할                                    |
    | 대상서버   | 해당 Server, 일반적으로 VM 등 가벼운 Server를 이용해 Test |


## 테스트 범위
* 테스트할 대상의 범위를 지정한다. 선정된 대상의 정보를 확인한다.
    * 대상 시스템
    * 대상 업무
    * Architecture
    * H/W
    * S/W
    * 구성정보 확인


## 목표 성능 지표
* 업무 처리량, Peak Time 등을 기준으로 향후 부하량 증가분을 반영하여 수립
* 목표 성능을 정한다.
* ex>
    | 항목        | 목표 성능                              | 비고                                                                                          |
    | ----------- | -------------------------------------- | --------------------------------------------------------------------------------------------- |
    | 목표 TPS    | 109TPS                                 | 1트랜잭션/1초 = 화면 1건 처리/1 변환                                                          |
    | 자원 사용률 | CPU : <60%                             | 가용성 기준 3Node의 CPU 사용량                                                                |
    | 응답 시간   | 응답시간 비율 : > 99% / 응답시간 : 3초 | Client Time = N/W Time + Channel Server Time + Swing, Server Time (Browser Parsing Time 제외) |
    * 목표 TPS : 트랜잭션 값을 서비스에 대한 트랜잭션 값으로 매칭하여 기준을 잡는다. WAS 처리 TPS -> 화면 기준으로 환산. ex> 109 TPS = 109 Page view/1s = 1초당 109 Page를 렌더링할 수 있는 성능(TPS)초를 원한다
    * 자원 사용률: CPU, Memory 등의 자원 사용률 기준을 잡는다. ex> VM 기준 H/W -> Hypervisor -> OS 순으로 올라가 있기 때문에, 100% -> 90% -> 60%로 기준을 잡는다.


## 테스트 수행 절차
![TestOrder](img/TestOrder.jpg)
* 일반적으로 단위 테스트 -> 통합 성능 테스트 -> 안전성 테스트 같은 절차를 세운다.
* 다음으로 대상, 성능 평가 항목, 모니터링 방식, 수행 담당자 등 절차에 대절 구체적인 사항을 결정한다. 
* 마지막으로 조직도, 역할을 구분한다.
    * 크게 조직은 5개로 구분된다.
    1) PM (Project Manager)
    2) Infra 지원팀 (System Engineer Team)
    3) 개발 지원팀 (Development Team)
    4) 성능 테스트 지원팀 (Team Operator)
    5) 고객사 Infra 담당자


## 수행일정
* 테스트 수행에 대한 전체적인 일정과 자세한 일정 모두 세운다.


## 테스트 시나리오
![TestScenario](img/TestScenario.jpg)
* 테스트 수행 절차에 따른 테스트 시나리오를 작성한다.
* 각 테스트 단계에 필요한 지원이 있다면 리스트하여 요청하거나 필요한 데이터 셋을 준비한다.


## 테스트 수행방법
![HowToTest](img/HowToTest.jpg)
* 시나리오에 작성한 수행방법데 대한 세부 사항을 결정한다.



## 테스트 수행 및 결과 수집



## 테스트 분석
* 테스트 결과 자료와 시스템 성능 자료를 모아서 테스트 결과를 분석한다. 분석된 자료를 통해서 성능에 영향을 미치는 문제점을 찾는다.


## 문제점 수정 및 재테스트
* 테스트 분석에서 발견된 문제점을 개발팀(Development Team)이나 시스템 운영팀(System Operation Team)에 전달하여 문제점을 수정하고 다시 한 번 테스트를 수행한다.


## 결과 리포트 작성
* 테스트 리포트는 목적에 따라 해당 목적을 가장 잘 표현할 수 있는 방식으로 작성한다. 요약 리포트와 상세 리포트를 분리해서 상세 경과를 필요로 하는 부서와 요약 결과만 필요로 하는 부서에 별도로 리포트를 제출하는 것도 좋은 방법이다.


## 주요 용어 및 개념
* Active User: 실제 서버에 연결된 상태로 요청을 처리 중인 사용





### Reference
* https://12bme.tistory.com/272