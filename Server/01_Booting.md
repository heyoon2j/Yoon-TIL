# Booting
![Booting_Sequence](img/Booting_Sequence.jpg)

</br>

## ğŸ“Œ Linux Booting Sequence
* BIOS : Basic Input/Output System. ì»´í“¨í„°ì˜ ì…ì¶œë ¥ì„ ì²˜ë¦¬í•˜ëŠ” íŒì›¨ì–´ 
* ROM : Read Only Memory
* Boot Loader : BIOSê°€ ë¶€íŒ… í”„ë¡œê·¸ë¨ì„ ì‹¤í–‰ì‹œí‚¤ëŠ” ì´ê°€ Boot Loader
1. Power On
    * ë©”ì¸ë³´ë“œì— ì „ì› ê³µê¸‰
    * ë©”ì¸ë³´ë“œì˜ ROMì„ í†µí•´ íŠ¹ì • ë²ˆì§€ì— ìˆëŠ” BIOSë¥¼ ì‹¤í–‰í•˜ë„ë¡ í•œë‹¤.
2. Execute BIOS Program
    * ìì²´ ì§„ë‹¨ ê¸°ëŠ¥ ì‹¤í–‰ (POST, Power On Self Test)
    * CMOS, CPU, Memory, ì£¼ë³€ì¥ì¹˜ ë“± ê°ì¢… ì¥ì¹˜ì˜ ì´ìƒ ìœ ë¬´ë¥¼ ê²€ì‚¬
3. Boot Loader ì‹¤í–‰ (Linux : GRUP)
    1) MBR(Master Boot Record) ë˜ëŠ” VBR(Volume Boot Record) ë¡œë“œ í›„ grup ì‹¤í–‰ (ì´ë•Œ bios_grup íŒŒí‹°ì…˜ì´ ìˆë‹¤ë©´ í•´ë‹¹ íŒŒí‹°ì…˜ìœ¼ë¡œ ì ‘ê·¼í•œë‹¤)
    2) /boot/grupì— ì ‘ê·¼í•˜ì—¬ ì»¤ë„(vmlinuz)ê´€ë ¨ íŒŒì¼ì„ ë©”ëª¨ë¦¬ì— ë¡œë“œí•œë‹¤
4. Loading Kernel
    1) ì»¤ë„ íŒŒì¼ ì‹¤í–‰
    2) PCI Bus ë° í•˜ë“œì›¨ì–´ ì ê²€ í›„, /var/log/dmesg ê¸°ë¡
    3) Process ID(PID) 0ì¸ swapper í”„ë¡œì„¸ìŠ¤ë¥¼ ì‹¤í–‰í•˜ì—¬ ê° ì¥ì¹˜ ë“œë¼ì´ë²„ ì´ˆê¸°í™”(ps ëª…ë ¹ì–´ì— ì•ˆë³´ì„ Memory context switching)
    4) ì´ˆê¸°í™” ì™„ë£Œ í›„, PID 1ì¸ init í”„ë¡œì„¸ìŠ¤ ì‹¤í–‰(systemd)
5. File System Mount
    * /etc/fstabì— ì§€ì •ëœëŒ€ë¡œ ë§ˆìš´íŠ¸ ì§„í–‰
    1) Root File System("/") ë§ˆìš´íŠ¸
    2) ê·¸ ì™¸ ë‹¤ë¥¸ íŒŒì¼ ì‹œìŠ¤í…œ ë§ˆìš´íŠ¸
6. init í”„ë¡œì„¸ìŠ¤ì— ë”°ë¼ ìˆœì„œëŒ€ë¡œ ì‹œìŠ¤í…œ ì´ˆê¸°í™” (/usr/lib/systemd/systemd)
    * /etc/rc.d/init.d ì‹¤í–‰
    * systemd-journald ì‹¤í–‰ (ì„œë¹„ìŠ¤ ë¡œê·¸ ì €ì¥)
    * ì„œë¹„ìŠ¤ ì‹¤í–‰
> Ref : https://lilo.tistory.com/21 / https://yonlog.tistory.com/59


## init system
### Log
* systemd-journald 
    - systemd ê¸°ë°˜ì˜ ë¡œê·¸ ê´€ë¦¬ ë°ëª¬
    - ë°”ì´ë„ˆë¦¬ë¡œ ì €ì¥
    - ëª¨ë“  ì‹œìŠ¤í…œì˜ ì „ë°˜ì ì¸ ë¡œê·¸ë¥¼ ìˆ˜ì§‘ (ì„¸ë¶€ì ì¸ ê±°ëŠ” X)
    - ì„¸ë¶€ ì„¤ì •, ì»¤ìŠ¤í…€ ë“±ì´ ì œí•œì ì´ë©°, ì›ê²© ì„œë²„ë¡œì˜ ë¡œê·¸ ì „ì†¡ ë¶ˆê°€ëŠ¥
* rsyslog
    - í…ìŠ¤íŠ¸ ê¸°ë°˜ ë¡œê·¸ë¥¼ /var/log ë””ë ‰í† ë¦¬ì— ì €ì¥í•˜ëŠ” ì„œë¹„ìŠ¤
    - í…ìŠ¤íŠ¸ë¡œ ì €ì¥
    - íŠ¹ì • ë¡œê·¸ë“¤ ìˆ˜ì§‘
    - ì„¸ë¶€ì ì¸ ì„¤ì •ì´ ê°€ëŠ¥í•˜ë©°, ì›ê²© ì„œë²„ë¡œì˜ ë¡œê·¸ ì „ì†¡ ê°€ëŠ¥

### Secure
* iptables / firewalld
    - ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½ì„ ì œì–´í•˜ëŠ” íŒ¨í‚· í•„í„°ë§ ì‹œìŠ¤í…œ (ë°ëª¬)
    - firewalldë‚˜ ì§ì ‘ iptables ëª…ë ¹ì„ í†µí•´ ì œì–´
    - firewalld: ë°©í™”ë²½ì„ ê´€ë¦¬í•˜ëŠ” ë°ëª¬ìœ¼ë¡œ, iptablesë¥¼ ê°„í¸í•˜ê²Œ ì„¤ì •í•  ìˆ˜ ìˆëŠ” ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µ
* selinux
    - SELinuxëŠ” ê°•í™”ëœ ë³´ì•ˆ ëª¨ë¸ì„ ì œê³µ
    - íŒŒì¼ê³¼ í”„ë¡œì„¸ìŠ¤ ê¶Œí•œì„ ë§¤ìš° ì„¸ë°€í•˜ê²Œ ì œì–´í•  ìˆ˜ ìˆëŠ” ë³´ì•ˆ ê¸°ëŠ¥
* auditd
    - ë³´ì•ˆ ê°ì‚¬ ë¡œê·¸ë¥¼ ìˆ˜ì§‘í•˜ëŠ” ë°ëª¬
    - ì‹œìŠ¤í…œ ì´ë²¤íŠ¸ì— ëŒ€í•œ ê°ì‚¬ ê¸°ë¡ì„ ë‚¨ê¹ë‹ˆë‹¤.
 
### Time & Scheduler
* chronyd
    - NTP(Network Time Protocol)ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‹œìŠ¤í…œ ì‹œê°„ì„ ë™ê¸°í™”í•˜ëŠ” ë°ëª¬
    - ìµœì‹  ì‹œìŠ¤í…œì—ì„œëŠ” ntpd ëŒ€ì‹  ì£¼ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤.
* crond
    - ì •ê¸° ì‘ì—…ì„ ì˜ˆì•½í•˜ì—¬ ì‹¤í–‰í•˜ëŠ” í¬ë¡  ë°ëª¬
    - ì‹œìŠ¤í…œ ê´€ë¦¬ ì‘ì—…(ë°±ì—…, ë¡œê·¸ ê´€ë¦¬ ë“±)ì„ ì£¼ê¸°ìœ¼ë¡œ ì‹¤í–‰

### í”„ë¡œì„¸ìŠ¤ ë° ìì› ê´€ë¦¬
* systemd
    - ì‹œìŠ¤í…œ ë¶€íŒ… ë° ì„œë¹„ìŠ¤ ê´€ë¦¬ë¥¼ ë‹´ë‹¹í•˜ëŠ” í•µì‹¬ ë°ëª¬ìœ¼ë¡œ, í”„ë¡œì„¸ìŠ¤, ì„œë¹„ìŠ¤, ìì›(ë©”ëª¨ë¦¬, CPU) ê´€ë¦¬ ë“±ì„ ìˆ˜í–‰
* cgroups
    - ì»¨íŠ¸ë¡¤ ê·¸ë£¹ìœ¼ë¡œ, ë¦¬ì†ŒìŠ¤ë¥¼ ì œì–´í•˜ê³  ì œí•œí•˜ì—¬ íŠ¹ì • ì„œë¹„ìŠ¤ë‚˜ í”„ë¡œì„¸ìŠ¤ì˜ ìì› ì‚¬ìš©ì„ ê´€ë¦¬


### ì¥ì¹˜ ê´€ë¦¬
* udevd: í•˜ë“œì›¨ì–´ ì¥ì¹˜ì˜ ë³€í™”ë¥¼ ê°ì§€í•˜ê³  ì‹œìŠ¤í…œì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤. ìƒˆ ì¥ì¹˜ê°€ ì—°ê²°ë˜ë©´ udev ê·œì¹™ì„ ì‚¬ìš©í•´ ìë™ìœ¼ë¡œ ì„¤ì •ì„ ì ìš©í•©ë‹ˆë‹¤.
* mdadm: RAID ê´€ë¦¬ ë„êµ¬ë¡œ, ì†Œí”„íŠ¸ì›¨ì–´ RAID ì„¤ì •ê³¼ ê´€ë¦¬ë¥¼ ë‹´ë‹¹í•©ë‹ˆë‹¤.


### Network
* NetworkManager: ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ë¥¼ ê´€ë¦¬í•˜ëŠ” ì„œë¹„ìŠ¤. ëŒ€ë¶€ë¶„ì˜ ë°ìŠ¤í¬íƒ‘ í™˜ê²½ê³¼ ì„œë²„ í™˜ê²½ì—ì„œ ì‚¬ìš©ë˜ë©°, ìœ ì„ /ë¬´ì„  ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ ìë™ìœ¼ë¡œ ê´€ë¦¬í•©ë‹ˆë‹¤.
* systemd-networkd: ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ì™€ ì—°ê²°ì„ ê´€ë¦¬í•˜ëŠ” systemd ì„œë¹„ìŠ¤ë¡œ, íŠ¹íˆ ì„œë²„ í™˜ê²½ì—ì„œ ìì£¼ ì‚¬ìš©ë©ë‹ˆë‹¤.
* network-scripts: ì´ì „ ë²„ì „ì˜ ë„¤íŠ¸ì›Œí¬ ê´€ë¦¬ ë„êµ¬. CentOS 7 ì´ì „ì—ì„œëŠ” ì´ ìŠ¤í¬ë¦½íŠ¸ê°€ ì£¼ë¡œ ì‚¬ìš©ë˜ì—ˆìœ¼ë©°, ìµœì‹  ë°°í¬íŒì—ì„œëŠ” NetworkManagerë¡œ ëŒ€ì²´ë˜ì—ˆìŠµë‹ˆë‹¤.
* dhclient: DHCP í´ë¼ì´ì–¸íŠ¸ë¡œ, ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ì— ë™ì ìœ¼ë¡œ IP ì£¼ì†Œë¥¼ í• ë‹¹ë°›ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤.

### íŒŒì¼ ì‹œìŠ¤í…œ ë° ìŠ¤í† ë¦¬ì§€
* systemd-udevd: í•˜ë“œì›¨ì–´ ì¥ì¹˜ì˜ ë³€ê²½ì„ ê°ì§€í•˜ê³  ì„¤ì •ì„ ì ìš©í•˜ëŠ” ë°ëª¬. ìƒˆë¡œìš´ ì¥ì¹˜ê°€ ì—°ê²°ë˜ê±°ë‚˜ ì œê±°ë˜ì—ˆì„ ë•Œ ì ì ˆí•œ ì„¤ì •ì„ ì ìš©í•©ë‹ˆë‹¤.
* LVM (Logical Volume Manager): ë””ìŠ¤í¬ íŒŒí‹°ì…˜ ê´€ë¦¬ë¥¼ ìœ„í•œ ì„œë¹„ìŠ¤ë¡œ, ë…¼ë¦¬ ë³¼ë¥¨ì„ ì‚¬ìš©í•˜ì—¬ ìœ ì—°í•œ ë””ìŠ¤í¬ ê³µê°„ í• ë‹¹ì„ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤.
* autofs: ìë™ ë§ˆìš´íŠ¸ ì„œë¹„ìŠ¤ë¡œ, íŠ¹ì • íŒŒì¼ ì‹œìŠ¤í…œì´ í•„ìš”í•  ë•Œ ìë™ìœ¼ë¡œ ë§ˆìš´íŠ¸ë˜ë„ë¡ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* nfs-server: Network File System (NFS) ì„œë²„ë¡œ, ë„¤íŠ¸ì›Œí¬ë¥¼ í†µí•´ íŒŒì¼ ì‹œìŠ¤í…œì„ ê³µìœ í•©ë‹ˆë‹¤.



---
## ğŸ“Œ PCR(Platform Configuration Register)
- **PCR**ì€ TPM(Trusted Platform Module) ë‚´ë¶€ì˜ ë ˆì§€ìŠ¤í„°
- ë¶€íŒ… ê³¼ì •ì—ì„œ íŒì›¨ì–´, ë¶€íŠ¸ë¡œë”, ì»¤ë„, OS êµ¬ì„±ìš”ì†Œ ë“±ì„ **í•´ì‹œ(ì¸¡ì •ê°’)**ìœ¼ë¡œ ê¸°ë¡í•˜ê³ , ì´ì „ ê°’ê³¼ í•¨ê»˜ `extend` ì—°ì‚°(ëˆ„ì  í•´ì‹œ)ìœ¼ë¡œ ê°±ì‹ í•œë‹¤
- ì´ì „ ê°’ê³¼ í˜„ì¬ ê°’ì„ ë¹„êµí•¨ìœ¼ë¡œì¨ ë¬´ê²°ì„±ì„ ê²€ì‚¬í•  ìˆ˜ ìˆë‹¤ (ì‹œìŠ¤í…œì´ ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ìƒíƒœì¸ì§€ í™•ì¸ ê°€ëŠ¥)

## PCR ë²ˆí˜¸ë³„ ì—­í•  (TPM 2.0 ê¸°ì¤€)

| PCR ë²ˆí˜¸ | ì£¼ìš” ì¸¡ì • ëŒ€ìƒ | ì„¤ëª… |
|----------|----------------|------|
| **PCR 0** | Core Root of Trust for Measurement (CRTM) | íŒì›¨ì–´ ì´ˆê¸° ì‹¤í–‰ ì½”ë“œ, BIOS/UEFI ì´ˆê¸°í™”. |
| **PCR 1** | Platform Configuration | CPU ë§ˆì´í¬ë¡œì½”ë“œ, íŒì›¨ì–´ ì„¤ì • ë“±. |
| **PCR 2** | Option ROMs | í™•ì¥ ì¹´ë“œ(ë„¤íŠ¸ì›Œí¬/ìŠ¤í† ë¦¬ì§€ ë“±)ì˜ Option ROM ì‹¤í–‰ ì½”ë“œ. |
| **PCR 3** | Platform-specific Configuration | ì¶”ê°€ íŒì›¨ì–´/í•˜ë“œì›¨ì–´ ì„¤ì • ê°’. |
| **PCR 4** | **Boot Manager / UEFI Application** | OS ë¡œë”(shim, grub, bootmgfw.efi ë“±). ë¶€íŠ¸ë¡œë”ê°€ ë°”ë€Œë©´ PCR4ê°€ ë³€í•¨. |
| **PCR 5** | OS Loader Config | OS ë¡œë” ì„¤ì •ê°’ (ì˜ˆ: grub.cfg, ì»¤ë„ íŒŒë¼ë¯¸í„°). |
| **PCR 6** | State Transitions | ACPI, SMM ì „í™˜, ê¸°íƒ€ ë³´ë“œ ë ˆë²¨ ìƒíƒœ ë³€í™”. |
| **PCR 7** | **Secure Boot Policy** | UEFI Secure Boot ë³€ìˆ˜(PK/KEK/db/dbx), Secure Boot on/off ì—¬ë¶€. Secure Boot í‚¤ê°€ ê°±ì‹ ë˜ë©´ PCR7 ê°’ì´ ë°”ë€œ. |
| **PCR 8â€“9** | OS Kernel ë° Drivers | ì»¤ë„, initrd/initramfs, ì´ˆê¸° ë“œë¼ì´ë²„. |
| **PCR 10** | OS-specific | OS ë¡œë” ì´í›„ ì¶”ê°€ ì¸¡ì •(ì¼ë¶€ Linuxì—ì„œëŠ” ë“œë¼ì´ë²„ ëª¨ë“ˆ, AppArmor/IMA ì •ì±…). |
| **PCR 11â€“13** | Runtime Config | ëŸ°íƒ€ì„ í™˜ê²½, ì¶”ê°€ ì†Œí”„íŠ¸ì›¨ì–´/ì •ì±…(IMA/EVM ë“±). |
| **PCR 14** | Debug | ë””ë²„ê·¸ ê´€ë ¨ ìƒíƒœ. |
| **PCR 15** | DRTM (Dynamic Root of Trust for Measurement) | TXT/TPM DRTM ì´ë²¤íŠ¸(Late launch). |

> ğŸ’¡ ì£¼ì˜: ì‹¤ì œ ë§¤í•‘ì€ **í”Œë«í¼Â·íŒì›¨ì–´Â·OS êµ¬í˜„**ì— ë”°ë¼ ë‹¤ì†Œ ì°¨ì´ê°€ ìˆë‹¤.  
> í•˜ì§€ë§Œ **PCR4 = ë¶€íŠ¸ë¡œë”, PCR7 = Secure Boot ì •ì±…**ì´ë¼ëŠ” ì ì€ ê±°ì˜ ê³µí†µ.


### ğŸ” í™œìš© ì˜ˆì‹œ
- **TPM Event Log** (`/sys/kernel/security/tpm0/binary_bios_measurements`)ë¥¼ í™•ì¸í•˜ë©´ ì–´ë–¤ ë°”ì´ë„ˆë¦¬/ë³€ìˆ˜ê°€ PCRì— extend ë˜ì—ˆëŠ”ì§€ ë³¼ ìˆ˜ ìˆìŒ.
- **ë¬´ê²°ì„± ê²€ì¦**
